<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>锂电固废环境风险评估系统</title>
    <style>
        /* 新增污染类别区块样式 */
        .pollution-category {
            background: #f8fafc;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid #e2e8f0;
        }

        .category-title {
            font-weight: 500;
            color: #fff;
            padding: 6px 12px;
            border-radius: 4px;
            margin: -5px 0 10px;
            display: inline-block;
        }

        /* 金属污染度颜色 */
        .high-pollution .category-title {
            background: #dc2626;
        }

        .medium-pollution .category-title {
            background: #d97706;
        }

        .low-pollution .category-title {
            background: #059669;
        }

        .mild-pollution .category-title {
            background: #2563eb;
        }

        /* 有机物分类对齐 */
        .organic-group {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .organic-category {
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
        }

        .environment-section {
            margin: 15px 0;
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        }

        .category-header {
            display: flex;
            align-items: center;
            margin: 15px 0 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e6ed;
        }

        .category-header h4 {
            margin: 0;
            font-size: 1.1em;
            color: #2c3e50;
            display: flex;
            align-items: center;
        }

        .category-header i {
            font-size: 1.2em;
            margin-right: 8px;
            color: #3498db;
        }

        .pollution-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 12px;
            margin: 10px 0;
        }

        .pollution-group label {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 6px;
            transition: all 0.2s;
            border: 1px solid #e9ecef;
        }

        .pollution-group label:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(52, 152, 219, 0.1);
            border-color: #3498db;
        }

        /* 污染等级颜色标签 */
        .pollution-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            margin-left: 8px;
            background: #eee;
        }

        .high-pollution {
            background: #fee2e2;
            color: #dc2626;
        }

        .medium-pollution {
            background: #fff3cd;
            color: #856404;
        }

        .low-pollution {
            background: #d4edda;
            color: #155724;
        }

        .mild-pollution {
            background: #d1ecf1;
            color: #0c5460;
        }

        /* 响应式调整 */
        @media (max-width: 768px) {
            .pollution-group {
                grid-template-columns: 1fr;
            }
        }

        /* 可选的淡红色文本样式 */
        .pink-text {
            color: #f8d7da;
        }

        /* 初始状态下，表格是隐藏的 */
        #myTable {
            display: none;
            border-collapse: collapse;
            width: 100%;
        }

        #myTable th, #myTable td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        /* 简单的表格样式 */
        table {
            margin-top: 10px;
            width: 100%;
        }

        /* 新增整体样式 */
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap');
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --border-radius: 8px;
        }

        body {
            font-family: 'Roboto', sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 30px;
            background: #f5f6fa;
            line-height: 1.6;
            color: var(--primary-color);
        }

        h1 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 30px;
            font-weight: 500;
            font-size: 2.2em;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }

        fieldset {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #dfe6e9;
            border-radius: var(--border-radius);
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        legend {
            font-weight: 500;
            padding: 8px 16px;
            background: var(--secondary-color);
            color: white;
            border-radius: var(--border-radius);
            font-size: 1.1em;
            letter-spacing: 0.5px;
        }

        /* 输入框样式 */
        input[type="number"],
        input[type="checkbox"] + label {
            transition: all 0.3s ease;
            padding: 8px 12px;
            border: 2px solid #dfe6e9;
            border-radius: 6px;
            margin: 5px 0;
        }

        input[type="number"]:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            outline: none;
        }

        /* 按钮样式 */
        button {
            background: linear-gradient(135deg, var(--secondary-color), #2980b9);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            letter-spacing: 0.5px;
            transition: transform 0.2s, box-shadow 0.2s;
            display: block;
            width: auto;
            padding: 12px 30px;
            margin: 0;
        }


        /* 新增按钮容器样式 */
        @media (max-width: 480px) {
            div.button-container {
                flex-direction: column;
            }

            div.button-container button {
                width: 100%;
            }
        }

        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        /* 表格美化 */
        table {
            width: 100%;
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
        }

        th {
            background: var(--primary-color);
            color: white;
            font-weight: 500;
            padding: 12px !important;
        }

        td {
            padding: 10px !important;
        }

        tr:nth-child(even) {
            background: #f8f9fa;
        }

        /* 警告信息 */
        .warning {
            background: #ffeef0;
            color: var(--danger-color);
            padding: 12px;
            border-radius: 6px;
            margin-top: 15px;
            border: 1px solid #ffd6d6;
            display: flex;
            align-items: center;
        }

        /* 动态添加项样式 */
        .toxicity-item {
            background: #f8fafc;
            padding: 12px;
            border-radius: 6px;
            margin: 10px 0;
            border: 1px solid #e0e7ff;
        }

        .remove-btn {
            color: var(--danger-color);
            cursor: pointer;
            font-weight: 500;
            margin-left: 15px;
            transition: opacity 0.2s;
        }

        .remove-btn:hover {
            opacity: 0.8;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }

            fieldset {
                padding: 15px;
            }

            .toxicity-item {
                flex-wrap: wrap;
            }

            input[type="number"] {
                width: 100%;
            }
        }

        /* 复选框美化 */
        input[type="checkbox"] {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border: 2px solid #bdc3c7;
            border-radius: 4px;
            margin-right: 8px;
            position: relative;
            top: 3px;
            cursor: pointer;
        }

        input[type="checkbox"]:checked {
            background: var(--secondary-color);
            border-color: var(--secondary-color);
        }

        input[type="checkbox"]:checked::after {
            content: "✓";
            color: white;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
        }
    </style>
</head>
<body>
<h1>锂电固废环境风险评估系统</h1>

<!-- 环境属性 -->
<fieldset>
    <legend>环境属性 (权重40%)</legend>
    <p class="warning-note"><i class="fas fa-info-circle"></i> 选取原则：考虑待评估固废主要成分中前七位金属和前七位有机物
    </p>

    <!-- 金属污染物 -->
    <div class="environment-section">
        <h4 class="section-title"><i class="fas fa-radiation"></i> 金属污染物选择</h4>

        <!-- 高污染度 -->
        <div class="pollution-category high-pollution">
            <div class="category-title">高污染度（得分1.0）</div>
            <div class="pollution-group">
                <label><input type="checkbox" class="metal" data-score="1">钴</label>
                <label><input type="checkbox" class="metal" data-score="1">铬</label>
                <label><input type="checkbox" class="metal" data-score="1">砷</label>
                <label><input type="checkbox" class="metal" data-score="1">铑</label>
                <label><input type="checkbox" class="metal" data-score="1">铂</label>
                <label><input type="checkbox" class="metal" data-score="1">铅</label>
                <label><input type="checkbox" class="metal" data-score="1">铱</label>
                <label><input type="checkbox" class="metal" data-score="1">锇</label>
                <label><input type="checkbox" class="metal" data-score="1">汞</label>
                <label><input type="checkbox" class="metal" data-score="1">铼</label>
                <label><input type="checkbox" class="metal" data-score="1">钌</label>
                <label><input type="checkbox" class="metal" data-score="1">钪</label>
                <label><input type="checkbox" class="metal" data-score="1">银</label>
            </div>
        </div>

        <!-- 中污染度 -->
        <div class="pollution-category medium-pollution">
            <div class="category-title">中污染度（得分0.7）</div>
            <div class="pollution-group">
                <label><input type="checkbox" class="metal" data-score="0.7">铀</label>
                <label><input type="checkbox" class="metal" data-score="0.7">镧</label>
                <label><input type="checkbox" class="metal" data-score="0.7">碲</label>
                <label><input type="checkbox" class="metal" data-score="0.7">铥</label>
                <label><input type="checkbox" class="metal" data-score="0.7">铕</label>
                <label><input type="checkbox" class="metal" data-score="0.7">锗</label>
                <label><input type="checkbox" class="metal" data-score="0.7">钽</label>
                <label><input type="checkbox" class="metal" data-score="0.7">铽</label>
                <label><input type="checkbox" class="metal" data-score="0.7">钼</label>
                <label><input type="checkbox" class="metal" data-score="0.7">钬</label>
                <label><input type="checkbox" class="metal" data-score="0.7">铟</label>
                <label><input type="checkbox" class="metal" data-score="0.7">镓</label>
                <label><input type="checkbox" class="metal" data-score="0.7">锑</label>
                <label><input type="checkbox" class="metal" data-score="0.7">镱</label>
                <label><input type="checkbox" class="metal" data-score="0.7">镉</label>
                <label><input type="checkbox" class="metal" data-score="0.7">镍</label>
                <label><input type="checkbox" class="metal" data-score="0.7">锰</label>
            </div>
        </div>

        <!-- 低污染度 -->
        <div class="pollution-category low-pollution">
            <div class="category-title">低污染度（得分0.4）</div>
            <div class="pollution-group">
                <label><input type="checkbox" class="metal" data-score="0.4">铪</label>
                <label><input type="checkbox" class="metal" data-score="0.4">铜</label>
                <label><input type="checkbox" class="metal" data-score="0.4">铍</label>
                <label><input type="checkbox" class="metal" data-score="0.4">钍</label>
                <label><input type="checkbox" class="metal" data-score="0.4">钐</label>
                <label><input type="checkbox" class="metal" data-score="0.4">镝</label>
                <label><input type="checkbox" class="metal" data-score="0.4">铋</label>
                <label><input type="checkbox" class="metal" data-score="0.4">铒</label>
                <label><input type="checkbox" class="metal" data-score="0.4">钆</label>
                <label><input type="checkbox" class="metal" data-score="0.4">硒</label>
                <label><input type="checkbox" class="metal" data-score="0.4">锡</label>
                <label><input type="checkbox" class="metal" data-score="0.4">钨</label>
                <label><input type="checkbox" class="metal" data-score="0.4">钒</label>
                <label><input type="checkbox" class="metal" data-score="0.4">钕</label>
                <label><input type="checkbox" class="metal" data-score="0.4">金</label>
            </div>
        </div>

        <!-- 轻微污染度 -->
        <div class="pollution-category mild-pollution">
            <div class="category-title">轻微污染度（得分0.1）</div>
            <div class="pollution-group">
                <label><input type="checkbox" class="metal" data-score="0.1">钇</label>
                <label><input type="checkbox" class="metal" data-score="0.1">铈</label>
                <label><input type="checkbox" class="metal" data-score="0.1">铌</label>
                <label><input type="checkbox" class="metal" data-score="0.1">镧</label>
                <label><input type="checkbox" class="metal" data-score="0.1">铝</label>
                <label><input type="checkbox" class="metal" data-score="0.1">锂</label>
                <label><input type="checkbox" class="metal" data-score="0.1">锌</label>
                <label><input type="checkbox" class="metal" data-score="0.1">钛</label>
                <label><input type="checkbox" class="metal" data-score="0.1">镁</label>
                <label><input type="checkbox" class="metal" data-score="0.1">锶</label>
                <label><input type="checkbox" class="metal" data-score="0.1">铁</label>
                <label><input type="checkbox" class="metal" data-score="0.1">硼</label>
                <label><input type="checkbox" class="metal" data-score="0.1">锆</label>
                <label><input type="checkbox" class="metal" data-score="0.1">钡</label>
            </div>
        </div>
    </div>

    <!-- 有机物污染物 -->
    <div class="environment-section">
        <h4 class="section-title"><i class="fas fa-flask"></i> 有机物污染物选择</h4>
        <div class="organic-group">
            <!-- 左侧列 -->
            <div class="organic-category">
                <div class="category-title" style="background:#2563eb; margin-top:15px">一类管控名录中含有此有机物（0.1）</div>
                <div class="pollution-group">
                    <label><input type="checkbox" name="others" class="youjiwu" data-score="0.1">聚偏氟乙烯(PVDF)</label>
                    <label><input type="checkbox" name="others" class="youjiwu" data-score="0.1">ABS塑料</label>
                    <label><input type="checkbox" name="others" class="youjiwu" data-score="0.1">乙醇</label>
                </div>

                <div class="category-title" style="background:#dc2626">二类管控名录中皆含有此有机物（0.4）</div>
                <div class="pollution-group">
                    <label><input type="checkbox" name="others" class="youjiwu" data-score="0.4">N-甲基吡咯烷酮(NMP)</label>
                    <label><input type="checkbox" name="others" class="youjiwu" data-score="0.4">卡尔费休液</label>
                    <label><input type="checkbox" name="others" class="youjiwu" data-score="0.4">碳酸二甲酯(DMC)</label>
                    <label><input type="checkbox" name="others" class="youjiwu" data-score="0.4">乙酸乙酯</label>
                    <label><input type="checkbox" name="others" class="youjiwu" data-score="0.4">碳酸二乙酯(DEC)</label>
                </div>

                <div class="category-title" style="background:#d97706">三类管控名录中皆含有此有机物（0.7）</div>
                <div class="pollution-group">
                    <label><input type="checkbox" name="others" class="youjiwu" data-score="0.7">丁苯橡胶(SBR)</label>
                </div>
            </div>

            <!-- 右侧列 -->
            <div class="organic-category">
                <div class="category-title" style="background:#dc2626">四类管控名录中皆含有此有机物（1.0）</div>
                <div class="pollution-group">
                    <label><input type="checkbox" name="others" class="youjiwu" data-score="1">异氰酸酯共聚物</label>
                </div>
                <div class="category-title" style="background:#059669; margin-top:15px">不在管控名录（0）</div>
                <div class="pollution-group">
                    <label><input type="checkbox" name="others" class="youjiwu" data-score="0">羧甲基纤维素钠(CMC)</label>
                    <label><input type="checkbox" name="others" class="youjiwu" data-score="0">聚丙烯(PP)</label>
                    <label><input type="checkbox" name="others" class="youjiwu" data-score="0">聚乙烯(PE)</label>
                    <label><input type="checkbox" name="others" class="youjiwu" data-score="0">聚氯乙烯(PVC)</label>
                    <label><input type="checkbox" name="others" class="youjiwu" data-score="0">聚苯乙烯(PS)</label>
                    <label><input type="checkbox" name="others" class="youjiwu" data-score="0">聚碳酸酯(PC)</label>
                    <label><input type="checkbox" name="others" class="youjiwu" data-score="0">乙二醇</label>
                    <label><input type="checkbox" name="others" class="youjiwu" data-score="0">聚醚树脂</label>
                </div>
            </div>
        </div>
    </div>

    <!-- 其他污染因子 -->
    <div class="environment-section">
        <div class="category-header" style="margin:15px 0 20px;">
            <h4 class="section-title">
                <i class="fas fa-vial"></i> <!-- 使用不同的图标以示区分 -->
                其他污染因子
            </h4>
        </div>

        <div class="pollution-group">
            <label>氟化物（0.4）<input type="checkbox" class="others" data-score="0.4"> </label>
            <label>含磷污染物（0.4）<input type="checkbox" class="others" data-score="0.4"> </label>
            <label>氯化物（0.1）<input type="checkbox" class="others" data-score="0.1"> </label>
            <label>硫化物（0.1）<input type="checkbox" class="others" data-score="0.1"> </label>
        </div>
    </div>
</fieldset>

<fieldset>
    <legend>生物毒性 (权重10%)</legend>

    <div>
       <p style="color: black; margin: 0;">
                   说明：根据
       <span style="color: orangered; font-weight: bold;">前七位金属</span>
                   和
       <span style="color: orangered; font-weight: bold;">前七位有机物</span>
                   计算生物毒性，
       <span style="color: orangered; font-weight: bold;">
                  注意所有有机物选择不应超过7种。
       </p>    
    </div>


    <!-- 新增其他污染物区块 -->
    <div class="pollution-category" style="margin-top:20px;">
        <div class="category-header" style="margin:15px 0 20px;">
            <h4 class="section-title">
                <i class="fas fa-vial"></i> <!-- 使用不同的图标以示区分 -->
                其他污染物
            </h4>
        </div>

        <!-- 无机物分组 -->
        <div class="organic-group" style="grid-template-columns: repeat(2, 1fr); margin-top:10px;">
            <div class="organic-category">
                <div class="category-title" style="background:#4a5568;">无机物</div>
                <div class="pollution-group">
                    <label><input type="checkbox" class="others" data-score="0">六氟磷酸锂</label>
                    <label><input type="checkbox" class="others" data-score="0">石墨</label>
                    <label><input type="checkbox" class="others" data-score="0">炭黑</label>
                    <label><input type="checkbox" class="others" data-score="0">二氧化硅</label>
                </div>
            </div>

            <!-- 有机物分组 -->
            <div class="organic-category">
                <div class="category-title" style="background:#4a5568;">有机物</div>
                <div class="pollution-group">
                    <label><input type="checkbox" class="others" name="others" data-score="0">聚氨酯</label>
                    <label><input type="checkbox" class="others" name="others" data-score="0">聚吡咯(PPy)</label>
                    <label><input type="checkbox" class="others" name="others" data-score="0">1,4,5,8-四羟基-9,10-蒽醌(THAQ)</label>
                    <label><input type="checkbox" class="others" name="others" data-score="0">聚四氟乙烯(PTFE)</label>
                    <label><input type="checkbox" class="others" name="others" data-score="0">聚酯树脂</label>
                    <label><input type="checkbox" class="others" name="others" data-score="0">聚乙烯醇(PVA)</label>
                </div>
            </div>
        </div>
    </div>
    <div>        
        <p style="text-indent: 30px; font-size: 14px;">说明：污染物名称：急性毒性LD50（mg/kg）→ 分数， 生态毒性EC50（mg/kg） →
            分数</p>
        <p style="text-indent: 30px; font-size: 16px; font-weight: bold;">生物毒性计算结果：</p>
        <div id="autoToxicityList"></div>
    </div>
</fieldset>

<!-- 修改后的资源属性模块 -->
<fieldset>
    <legend>资源属性 (权重40%)</legend>

    <!-- 关键资源固定输入 -->
    <div class="resource-section">
        <h4>关键资源数量：</h4>
        <div class="key-resource-item">
            <label>一级关键资源（1.0）数量：
                <input type="number" id="level1" min="0" value="0" style="width: 80px" disabled>
            </label>
        </div>
        <div class="key-resource-item">
            <label>二级关键资源（0.7）数量：
                <input type="number" id="level2" min="0" value="0" style="width: 80px" disabled>
            </label>
        </div>
        <div class="key-resource-item">
            <label>三级关键资源（0.4）数量：
                <input type="number" id="level3" min="0" value="0" style="width: 80px" disabled>
            </label>
        </div>
        <div class="key-resource-item">
            <label>四级关键资源（0.2）数量：
                <input type="number" id="level4" min="0" value="0" style="width: 80px" disabled>
            </label>
        </div>
    </div>

    <!-- 可回收非关键资源数量 -->
    <div class="resource-section" style="margin-top:15px">
        <h4>可回收非关键资源：</h4>
        <label> 可回收非关键资源（0.1）数量
            <input type="number" id="recyclable" min="0" value="0" style="width: 80px">
        </label>
    </div>

    <!-- 复杂度计算 -->
    <div style="margin-top:15px">
        <h4>资源复杂度：</h4>
        <label>关键资源总数：<input type="number" id="totalResourceTypes" min="0" value="0" disabled></label>
    </div>
</fieldset>

<!-- 排放强度 -->
<fieldset>
    <legend>排放强度 (权重10%)</legend>
    <div>
        <label>年固废总量(吨):
            <input type="number" id="totalWaste" min="0" value="0">
        </label>
    </div>
    <div>
        <label>年处理量(吨):
            <input type="number" id="treatedWaste" min="0" value="0">
        </label>
    </div>
</fieldset>

<div style="display: flex; justify-content: center; gap: 20px; margin-top: 30px">
    <button onclick="calculate()">开始计算</button>
    <button onclick="clearForm()" style="background: linear-gradient(135deg, #95a5a6, #7f8c8d)">清除数据</button>
</div>
<div id="result"></div>
<div id="warning" class="warning"></div>

<script>
    // 新增毒性数据库（与表格数据对应）
    const toxicityDB = {
        // 金属类
        "锂": {ld50: 150, ec50: 600},
        "镍": {ld50: 800, ec50: 45},
        "钴": {ld50: 300, ec50: 300},
        "锰": {ld50: 1500, ec50: 350},
        "铁": {ld50: 100, ec50: 650},
        "铝": {ld50: 5000, ec50: 800},
        "铜": {ld50: 25, ec50: 2.5},

        //其他无机物
        "六氟磷酸锂": {ld50: 170, ec50: 30},
        "石墨": {ld50: Infinity, ec50: Infinity},
        "炭黑": {ld50: Infinity, ec50: Infinity},
        "二氧化硅": {ld50: Infinity, ec50: Infinity},

        // 有机物类
        "N-甲基吡咯烷酮(NMP)": {ld50: 3910, ec50: 100},
        "聚偏氟乙烯(PVDF)": {ld50: Infinity, ec50: Infinity},
        "羧甲基纤维素钠(CMC)": {ld50: 27000, ec50: 3000},
        "丁苯橡胶(SBR)": {ld50: Infinity, ec50: 1300},
        "聚氨酯": {ld50: Infinity, ec50: 230},
        "聚吡咯(PPy)": {ld50: Infinity, ec50: 400},
        "1,4,5,8-四羟基-9,10-蒽醌(THAQ)": {ld50: 2200, ec50: 150},
        "聚四氟乙烯(PTFE)": {ld50: 2000, ec50: 2200},
        "碳酸二甲酯(DMC)": {ld50: 9000, ec50: 6000},
        "聚醚树脂": {ld50: 6000, ec50: 1300},
        "聚酯树脂": {ld50: 6000, ec50: 1400},
        "异氰酸酯共聚物": {ld50: 5800, ec50: 45},
        "乙酸乙酯": {ld50: 5620, ec50: 450},
        "聚氯乙烯(PVC)": {ld50: 238, ec50: 250},
        "ABS塑料": {ld50: 48, ec50: 300},
        "聚乙烯(PE)": {ld50: Infinity, ec50: Infinity},
        "聚丙烯(PP)": {ld50: Infinity, ec50: Infinity},
        "聚碳酸酯(PC)": {ld50: 2200, ec50: 4800},
        "聚苯乙烯(PS)": {ld50: 1800, ec50: 4400},
        "聚乙烯醇(PVA)": {ld50: 20000, ec50: 4000}
    };

    document.addEventListener("DOMContentLoaded", function() {
        // 金属污染物选择限制
        document.querySelectorAll('.metal').forEach(checkbox => {
            checkbox.addEventListener('change', metalCheckHandler);
        });

        // 有机物污染物选择限制（仅关注 name="others" 的复选框）
        document.querySelectorAll('input[type="checkbox"][name="others"]').forEach(checkbox => {
            checkbox.addEventListener('change', organicCheckHandler);
        });
    });

    // 金属选择处理函数
    function metalCheckHandler() {
        const selected = document.querySelectorAll('.metal:checked').length;
        if (this.checked && selected > 7) {
            this.checked = false;
            alert("金属污染物最多选择7种！");
        }
    }

    // 有机物选择处理函数（新增精确计数）
    function organicCheckHandler() {
        const selected = document.querySelectorAll('input[type="checkbox"][name="others"]:checked').length;
        if (this.checked && selected > 7) {
            this.checked = false;
            alert("有机污染物总数不能超过7种！");
        }
    }

    // 自动获取选中污染物的毒性数据
    function getSelectedPollutants() {
        // 获取所有选中的金属和有机物
        const selected = [];

        // 获取金属污染物
        document.querySelectorAll('.metal:checked').forEach(checkbox => {
            const metalName = checkbox.parentElement.textContent.trim();
            selected.push(metalName);
        });

        // 获取有机物污染物
        document.querySelectorAll('.youjiwu:checked').forEach(checkbox => {
            const organicName = checkbox.parentElement.textContent.trim();
            selected.push(organicName);
        });

        // 新增：获取其他污染物
        document.querySelectorAll('.others:checked').forEach(checkbox => {
            const OtherName = checkbox.parentElement.textContent.trim();
            selected.push(OtherName);
        });

        return selected;  // 添加这行返回收集的污染物数组
    }

    // 生物毒性计算函数
    function calculateToxicity() {
        const pollutants = getSelectedPollutants();
        let totalBioScore = 0;
        let displayHTML = "<ul>";

        pollutants.forEach(name => {
            const data = toxicityDB[name] || {ld50: 'ignor', ec50: 'ignor'};
            const ldScore = calculateSingleToxicity(data.ld50, 'ld50');
            const ecScore = calculateSingleToxicity(data.ec50, 'ec50');

            if (data.ld50 === 'ignor' && data.ec50 === 'ignor') {
                // 不在清单中情况不做处理
            } else {
                // 累计得分
                totalBioScore += (ldScore + ecScore);
                console.log(name+"mixScore="+(ldScore + ecScore)+",ldScore="+ldScore+",ecScore="+ecScore)
                // 生成显示内容
                const ld50Str = data.ld50 == Infinity ? "无毒" : data.ld50;
                const ec50Str = data.ec50 == Infinity ? "无毒" : data.ec50
                displayHTML += `
                <li>${name}：
                    <span style="color: mediumblue;">LD50</span>: ${ld50Str} → ${ldScore.toFixed(3)}， 
                    <span style="color: mediumblue;">EC50</span>: ${ec50Str} → ${ecScore.toFixed(3)}
                </li>`;
            }
        });
        displayHTML += "</ul>";
        document.getElementById('autoToxicityList').innerHTML = displayHTML;

        return totalBioScore;
    }

    function calculateSingleToxicity(value, type) {
        if (value === Infinity) return 0; // 无毒情况处理

        if (type === 'ld50') {
            if (value <= 50) return 0.7;
            else if (value <= 2000) return 0.7 - (value - 50) * (0.7 - 0.4) / (2000 - 50);
            else if (value <= 5000) return 0.4 - (value - 2000) * (0.4 - 0.1) / (5000 - 2000);
            else return 0.1;
        } else if (type === 'ec50') {
            if (value <= 50) return 0.7;
            else if (value <= 500) return 0.7 - (value - 50) * (0.7 - 0.4) / (500 - 50);
            else if (value <= 2000) return 0.4 - (value - 500) * (0.4 - 0.1) / (2000 - 500);
            else return 0.1;
        }
        return 0;
    }

    const keyResourceMap = {
        // 一级关键资源（铂族金属、钴等）
        "铂": 1,
        "铱": 1,
        "锇": 1,
        "铑": 1,
        "钌": 1,
        "钯": 1,
        "钴": 1,
        "铌": 1,

        // 二级关键资源（锗、锆等）
        "锗": 2,
        "锆": 2,
        "硒": 2,
        "铬": 2,

        // 三级关键资源（锂、镍等） 
        "锂": 3,
        "镍": 3,
        "硼": 3,
        "锰": 3,
        "镁": 3,
        "钽": 3,
        "铼": 3,
        "铯": 3,
        "镓": 3,
        "铍": 3,
        "钪": 3,
        "钇": 3,
        "镧": 3,
        "铈": 3,
        "镨": 3,
        "钕": 3,
        "钷": 3,
        "钐": 3,
        "铕": 3,
        "钆": 3,
        "铽": 3,
        "镝": 3,
        "钬": 3,
        "铒": 3,
        "铥": 3,
        "镱": 3,
        "镥": 3,
        "锡": 3,
        "钼": 3,
        "钨": 3,
        "铷": 3,
        "钒": 3,

        // 四级关键资源（汞、砷等）
        "汞": 4,
        "砷": 4,
        "硫化物": 4,
        "锶": 4,
        "铅": 4,
        "镉": 4,
        "铋": 4,
        "铝": 4,
        "铁": 4,
        "锑": 4,
        "含磷污染物": 4,
        "锌": 4,
        "铟": 4,
        "钛": 4,
        "碲": 4,
        "金": 4,
        "铜": 4,
        "二氧化硅": 4,
        "钡": 4
    };

    function updateKeyResources() {
        // 初始化各等级计数器
        const counters = {1: 0, 2: 0, 3: 0, 4: 0};

        // 获取所有选中的金属污染物
        document.querySelectorAll('.metal:checked').forEach(checkbox => {
            const metal = checkbox.parentElement.textContent.trim();
            const level = keyResourceMap[metal];
            if (level) counters[level]++;
        });

        // 更新输入框值
        [1, 2, 3, 4].forEach(level => {
            document.getElementById(`level${level}`).value = counters[level];
        });

        // 触发复杂度计算
        calculateResource();
    }

    // 为所有金属复选框添加事件监听
    function initMetalEvents() {
        document.getElementById("warning").style.visibility = "hidden";
        document.querySelectorAll('.metal').forEach(checkbox => {
            checkbox.addEventListener('change', updateKeyResources);
        });
    }

    // 添加选择变化监听（当用户选择污染物时自动更新显示）
    document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        checkbox.addEventListener('change', () => {
            calculateToxicity(); // 实时更新显示
        });
    });

    // 初始化时计算一次
    calculateToxicity();

    // 资源属性计算函数
    function calculateResource() {
        // 各等级资源得分系数
        const levelScores = {
            1: 1,    // 一级
            2: 0.7,  // 二级
            3: 0.4,  // 三级
            4: 0.2   // 四级
        };

        let totalScore = 0;
        let totalTypes = 0;

        // 计算关键资源得分
        [1, 2, 3, 4].forEach(level => {
            const count = parseInt(document.getElementById(`level${level}`).value) || 0;
            totalScore += levelScores[level] * count;
            console.log(`level${level} count=${count}, score=${levelScores[level] * count}`)
            if (count > 0) totalTypes += count;
        });

        // 可回收非关键资源得分
        const isNonKeyScore = parseInt(document.getElementById('recyclable').value)

        // 计算复杂度
        const complexity =
            totalTypes > 4 ? 1 :
                totalTypes > 2 ? 0.7 :
                    totalTypes >= 1 ? 0.1 : 0;
        console.log(`计数=${totalTypes},关键=${totalScore},非关键=${isNonKeyScore},可回收=${isNonKeyScore}`)

        // 更新总种类数显示
        document.getElementById('totalResourceTypes').value = totalTypes;

        // 综合计算（关键资源得分 + 非关键资源得分）* 复杂度系数
        return {
            total: totalScore + complexity + (isNonKeyScore > 0 ? 0.1 * isNonKeyScore : 0),
            details: {
                keyScore: totalScore,
            }
        };
    }


    // 主计算函数
    function calculate() {

        // 环境属性计算
        let envScore = 0;

        // 金属污染得分
        document.querySelectorAll('.metal:checked').forEach(checkbox => {
            envScore += parseFloat(checkbox.dataset.score);
        });

        // 有机物污染得分
        document.querySelectorAll('.youjiwu:checked').forEach(checkbox => {
            envScore += parseFloat(checkbox.dataset.score);
        });

        // 其他污染因子
        document.querySelectorAll('.others:checked').forEach(checkbox => {
            envScore += parseFloat(checkbox.dataset.score);
        });

        // 生物毒性计算
        const bioScore = calculateToxicity(); // 自动计算

        // 资源属性计算
        const resourceResult = calculateResource();
        const totalResource = resourceResult.total;

        // 排放强度计算
        const total = parseFloat(document.getElementById('totalWaste').value);
        const treated = parseFloat(document.getElementById('treatedWaste').value);
        const untreatedRatio = ((total - treated) / total) * 100 || 0;

        let emissionScore = 0;
        if (untreatedRatio > 50) emissionScore = 0.7;
        else if (untreatedRatio >= 20) emissionScore = 0.4 + (0.3 * (50 - untreatedRatio) / 30);
        else if (untreatedRatio >= 5) emissionScore = 0.1 + (0.3 * (20 - untreatedRatio) / 15);
        else if (untreatedRatio === 0) emissionScore = 0;
        else emissionScore = 0.1;

        // 综合计算
        const totalScore =
            10 * ((envScore / 15 * 0.4) +      // 环境属性标准化到0-0.4
                (bioScore / 14 * 0.1) +
                (totalResource / 8.4 * 0.4) +
                (emissionScore * 0.1));

        console.log("环境属性:", envScore);
        console.log("生物毒性:", bioScore);
        console.log("资源属性:", totalResource);
        console.log("排放强度:", emissionScore);

        // 显示结果
        const resultHTML = `
                <h3>评估结果</h3>
                <table>
                    <tr><th>评估指标</th><th>得分</th><th>权重</th><th>加权得分</th></tr>
                    <tr><td>环境属性</td><td>${(envScore / 15).toFixed(3)}</td><td>40%</td><td>${(envScore * 0.4).toFixed(3)}</td></tr>
                    <tr><td>生物毒性</td><td>${(bioScore / 14).toFixed(3)}</td><td>10%</td><td>${(bioScore * 0.1).toFixed(3)}</td></tr>
                    <tr><td>资源属性</td><td>${(totalResource / 8.4).toFixed(3)}</td><td>40%</td><td>${(totalResource * 0.4).toFixed(3)}</td></tr>
                    <tr><td>排放强度</td><td>${emissionScore.toFixed(3)}</td><td>10%</td><td>${(emissionScore * 0.1).toFixed(3)}</td></tr>
                    <tr style="font-weight:bold">
                        <td colspan="3">综合环境风险得分</td>
                        <td>${totalScore.toFixed(3)}</td>
                    </tr>
                </table>
            `;

        document.getElementById('result').innerHTML = untreatedRatio < 0 ? "" : resultHTML;
        if (untreatedRatio < 0) {
            document.getElementById('warning').textContent = "警告：【排放强度】处理量不能超过固废总量！";
            document.getElementById("warning").style.visibility = "visible";
        } else {
            document.getElementById("warning").style.visibility = "hidden";
        }
    }

    // 新增清除表单函数
    function clearForm() {
        // 清除所有输入框
        document.querySelectorAll('input[type="number"]').forEach(input => {
            input.value = 0;
        });

        // 清除所有复选框
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.checked = false;
        });

        // 清除计算结果
        document.getElementById('result').innerHTML = '';
        document.getElementById('warning').textContent = '';
        document.getElementById('autoToxicityList').innerHTML = '';

        // 重置资源类型计数
        updateKeyResources();
        calculateToxicity();
        // 清除报错
        document.getElementById("warning").style.visibility = "hidden";
    }

    // 初始化页面
    initMetalEvents();

</script>
</body>
</html>
